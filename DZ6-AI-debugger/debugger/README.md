# ИИ Отладчик Python

Этот скрипт использует AI-модель через ProxyAPI для анализа логов ошибок Python, определения проблемного кода в конкретном файле и предложения исправления. Затем он представляет изменения в виде diff-сравнения и позволяет применить их непосредственно к исходному файлу.

## Возможности

*   Разбирает (парсит) Python traceback'и из лог-файлов.
*   Определяет путь к файлу, номер строки и сообщение об ошибке из traceback.
*   Загружает исходный код файла с ошибкой.
*   Формирует подробный промпт для AI-модели, предоставляя контекст логов и исходного кода.
*   Запрашивает у AI (через ProxyAPI) исправленную версию всего файла.
*   Отображает diff-сравнение между оригинальным и предложенным AI кодом.
*   Предлагает пользователю применить предложенные изменения.

## Предварительные требования

1.  **Python 3.x**
2.  **Необходимые Python пакеты**:
    ```bash
    pip install requests
    ```
    (`difflib` является частью стандартной библиотеки Python)
3.  **Аккаунт и ключ ProxyAPI**: Вам потребуется действующий API-ключ от [ProxyAPI](https://proxyapi.ru/) (или аналогичного сервиса, совместимого со структурой OpenAI API).
4.  **Предполагаемая структура директорий**:
    ```
    корень_вашего_проекта/
    ├── ваш_основной_файл_приложения.py
    ├── другие_файлы_приложения.py
    └── debugger/
        ├── debugger.py     # Этот скрипт
        └── logs/
            └── app.log     # Лог-файл будет создан здесь
    ```

## Конфигурация

Перед запуском отладчика вы **ДОЛЖНЫ** настроить ваш API-ключ:

1.  Откройте `debugger/debugger.py`.
2.  Найдите строку:
    ```python
    PROXY_API_KEY = '...' # <- Перед использованием нужно добавить API ключ
    ```
3.  Замените `'...'` вашим реальным ключом ProxyAPI.

Вы также можете изменить `MODEL_NAME`, если хотите использовать другую модель, совместимую с API (по умолчанию `'o4-mini'`).

## Как использовать

1.  **Настройка API-ключа**: Убедитесь, что `PROXY_API_KEY` установлен в `debugger/debugger.py` (см. раздел Конфигурация).

2.  **Генерация логов**:
    Запустите ваше основное Python-приложение и перенаправьте его стандартный поток ошибок (и, опционально, стандартный вывод) в лог-файл. Скрипт ожидает лог-файл по пути `debugger/logs/app.log` относительно корня вашего проекта.

    Из **корневой директории вашего проекта** используйте команду, подобную этой:
    ```bash
    python3 ваш_основной_файл_приложения.py 2>&1 | tee debugger/logs/app.log
    ```
    *   `ваш_основной_файл_приложения.py`: Замените на имя вашего основного Python-скрипта, который вы хотите отладить.
    *   `2>&1`: Перенаправляет стандартный поток ошибок (канал 2) в стандартный поток вывода (канал 1).
    *   `| tee debugger/logs/app.log`: Отправляет объединенный вывод одновременно в консоль (чтобы вы могли видеть его в реальном времени) и в указанный лог-файл.

3.  **Запуск отладчика**:
    Перейдите в **корневую директорию вашего проекта** в терминале и запустите скрипт отладчика:
    ```bash
    python debugger/debugger.py
    ```
    (Если вы уже находитесь в директории `debugger`, вы можете запустить `python debugger.py`, но путь по умолчанию к лог-файлу `debugger/logs/app.log` указывается относительно того места, *откуда запускается скрипт*. Приведенная выше настройка предполагает запуск из корня проекта.)

4.  **Просмотр и применение исправления**:
    *   Скрипт проанализирует `debugger/logs/app.log`.
    *   Если ошибка найдена, он выведет детали ошибки.
    *   Затем он запросит у AI исправление.
    *   Будет отображен `diff`, показывающий оригинальные строки (с префиксом `-`) и предложенные AI изменения (с префиксом `+`).
    *   Вам будет предложено: `Применить предложенные изменения? (y/n):`
        *   Введите `y`, чтобы перезаписать оригинальный файл кодом, предложенным AI.
        *   Введите `n`, чтобы отменить изменения.

## Важные замечания

*   **Безопасность API-ключа**: Никогда не коммитьте ваш `PROXY_API_KEY` в публичный репозиторий. Рассмотрите использование переменных окружения или gitignored файла конфигурации для лучшего управления ключами в крупных проектах.
*   **Путь к лог-файлу**: В скрипте в настоящее время жестко задан относительный путь к лог-файлу (`log_file_path = "debugger/logs/app.log"` в блоке `if __name__ == "__main__":`). Убедитесь, что ваша команда генерации логов и контекст выполнения отладчика соответствуют этому, или измените путь в скрипте.
*   **Извлечение ошибок**: Регулярное выражение для извлечения ошибок может не охватывать все возможные форматы traceback Python. Оно разработано для распространенных случаев.
*   **Лимиты токенов**: Очень большие исходные файлы или чрезвычайно длинные логи могут превысить лимиты токенов AI-модели или API-запроса. Скрипт пытается отправить разумный объем контекста логов.